<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Medical Provider Risk Database - Qui Tam Case Finder</title>
    <meta name="description" content="AI-ranked analysis of Medicare/Medicaid fraud cases for qui tam whistleblower opportunities." />

    <!-- Favicons -->
    <link rel="icon" href="/assets/favicon.ico" sizes="32x32" />
    <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png" />
    <link rel="manifest" href="/assets/site.webmanifest" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://yoursite.com/" />
    <meta property="og:title" content="Medical Provider Risk Database" />
    <meta property="og:description" content="AI-ranked analysis of Medicare/Medicaid fraud cases for qui tam whistleblower opportunities." />
    <meta property="og:image" content="https://yoursite.com/assets/table.png" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://yoursite.com/" />
    <meta property="twitter:title" content="Medical Provider Risk Database" />
    <meta property="twitter:description" content="AI-ranked analysis of Medicare/Medicaid fraud cases for qui tam whistleblower opportunities." />
    <meta property="twitter:image" content="https://yoursite.com/assets/table.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.3.1/styles/ag-grid.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.3.1/styles/ag-theme-alpine.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="loadingOverlay" class="loading-overlay hidden" role="status" aria-live="polite">
      <div class="loading-card">
        <div class="loading-spinner" aria-hidden="true"></div>
        <div class="loading-copy">
          <p id="loadingTitle">Loading Medical Records…</p>
          <p id="loadingSubtitle" class="loading-subtitle">Preparing data</p>
          <div class="loading-progress">
            <div id="loadingProgress" class="loading-progress-bar"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="inlineLoader" class="inline-loader hidden" aria-live="polite">
      <div class="pulse-dot" aria-hidden="true"></div>
      <p id="inlineLoaderText">Loading remaining files…</p>
    </div>

    <header>
      <div>
        <h1>Medical Provider Risk Database</h1>
        <p>AI-ranked analysis of medical fraud from CMS LEIE, DOJ settlements, and state medical boards. Identifying False Claims Act violations for qui tam lawsuits.</p>
      </div>
    </header>

    <section class="scripts-panel">
      <h2>Run Data Pipeline</h2>
      <p class="scripts-hint">Run Python scripts in order: Test Connection → Scraper → Converter → GPT Ranker. Output appears in the log below.</p>
      <div class="script-buttons">
        <button type="button" class="script-btn" data-script="test_connection">Test GPT Connection</button>
        <button type="button" class="script-btn" data-script="scraper">Run Scraper</button>
        <button type="button" class="script-btn" data-script="combine_website_scrapes">Combine Website Scrapes</button>
        <button type="button" class="script-btn" data-script="pubmed_trending">Scrape PubMed Trending</button>
        <button type="button" class="script-btn" data-script="converter">Run Converter</button>
        <button type="button" class="script-btn" data-script="gpt_ranker">Run GPT Ranker</button>
        <button type="button" id="scriptOutputStop" class="script-btn script-btn--stop" disabled>Stop</button>
        <button type="button" id="deleteDataBtn" class="script-btn script-btn--danger">Delete All Data</button>
      </div>
      <div class="website-scraper-panel" style="margin-top: 1.5rem; padding: 1rem; background: rgba(255, 255, 255, 0.03); border: 1px solid var(--panel-border); border-radius: 8px;">
        <h3 style="margin-top: 0; margin-bottom: 0.75rem; font-size: 1rem;">Scrape Website</h3>
        <p style="margin: 0 0 0.75rem 0; color: var(--muted); font-size: 0.9rem;">Enter a website URL to scrape. The scraped content will be saved in a format the converter can process.</p>
        <div style="display: flex; gap: 0.5rem; align-items: flex-end; flex-wrap: wrap;">
          <div style="flex: 1; min-width: 200px;">
            <label for="websiteUrl" style="display: block; margin-bottom: 0.25rem; font-size: 0.85rem; color: var(--muted);">Website URL</label>
            <input type="url" id="websiteUrl" placeholder="https://example.com" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.04); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: inherit; font-size: 0.9rem;" />
          </div>
          <div style="min-width: 100px;">
            <label for="maxPages" style="display: block; margin-bottom: 0.25rem; font-size: 0.85rem; color: var(--muted);">Max Articles</label>
            <input type="number" id="maxPages" value="10" min="1" max="50" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.04); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: inherit; font-size: 0.9rem;" />
          </div>
          <button type="button" id="scrapeWebsiteBtn" class="script-btn" style="margin-top: 1.5rem;">Scrape Website</button>
        </div>
        <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
          <div style="flex: 1; min-width: 200px;">
            <label for="urlPattern" style="display: block; margin-bottom: 0.25rem; font-size: 0.85rem; color: var(--muted);">URL Pattern (optional)</label>
            <input type="text" id="urlPattern" placeholder="e.g., /pubmed/ or /article/" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.04); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: inherit; font-size: 0.9rem;" />
            <small style="display: block; margin-top: 0.25rem; font-size: 0.75rem; color: var(--muted);">Match article URLs containing this pattern</small>
          </div>
          <div style="flex: 1; min-width: 200px;">
            <label for="linkSelector" style="display: block; margin-bottom: 0.25rem; font-size: 0.85rem; color: var(--muted);">CSS Selector (optional)</label>
            <input type="text" id="linkSelector" placeholder="e.g., a.article-link" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.04); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: inherit; font-size: 0.9rem;" />
            <small style="display: block; margin-top: 0.25rem; font-size: 0.75rem; color: var(--muted);">CSS selector for article links</small>
          </div>
        </div>
      </div>
      <div id="scriptOutputModal" class="script-output-modal hidden">
        <div class="script-output-inner">
          <div class="script-output-header">
            <h3 id="scriptOutputTitle">Script Output</h3>
            <div class="script-output-actions">
              <button type="button" id="scriptOutputStopModal" class="script-output-stop hidden">Stop</button>
              <button type="button" id="scriptOutputClose" class="script-output-close">Close</button>
            </div>
          </div>
          <pre id="scriptOutputPre"></pre>
        </div>
      </div>
    </section>

    <div class="processing-notice">
      <strong>Note:</strong> We are still processing medical board actions. Currently showing <span id="processedCount">—</span> providers.
      <span id="filterWaitNote" class="filter-wait-note hidden">Please wait for data to finish loading before using filters.</span>
    </div>

    <section class="controls">
      <div class="control-group">
        <label for="scoreFilter">Minimum Qui Tam Score: <span id="scoreValue">0</span></label>
        <input type="range" id="scoreFilter" min="0" max="100" value="0" step="1" />
      </div>

      <div class="control-group">
        <label for="leadTypeFilter">Fraud Types</label>
        <select id="leadTypeFilter" multiple></select>
      </div>

      <div class="control-group">
        <label for="powerFilter">Providers / Organizations</label>
        <select id="powerFilter" multiple></select>
      </div>

      <div class="control-group stretch">
        <label for="searchInput">Full-Text Search</label>
        <input type="search" id="searchInput" placeholder="Search providers, violations, fraud types..." />
      </div>

      <div class="control-group small">
        <label for="limitInput">Max Rows</label>
        <input type="number" id="limitInput" min="0" step="100" placeholder="All" />
      </div>

      <div class="control-group small">
        <label>&nbsp;</label>
        <button id="resetFilters" type="button">Reset Filters</button>
      </div>
    </section>

    <section class="summary" id="summaryPanel">
      <div>
        <p class="metric-label">Providers Analyzed</p>
        <p class="metric-value" id="countStat">0</p>
      </div>
      <div>
        <p class="metric-label">Avg. Risk Score</p>
        <p class="metric-value" id="avgStat">0</p>
      </div>
      <div>
        <p class="metric-label">Top Fraud Type</p>
        <p class="metric-value" id="leadStat">–</p>
      </div>
      <div>
        <p class="metric-label">Last Updated</p>
        <p class="metric-value" id="updatedStat">–</p>
      </div>
    </section>

    <section class="grid-panel">
      <div id="grid" class="ag-theme-alpine"></div>
    </section>

    <section id="detailDrawer" class="detail-drawer hidden">
      <div class="detail-header">
        <div>
          <p class="detail-label">Selected Provider</p>
          <h2 id="detailTitle">Select a row to view qui tam potential</h2>
          <p class="detail-hint">Click any row to see fraud details, evidence, and qui tam viability.</p>
        </div>
        <button id="detailClose" type="button">Close</button>
      </div>
      <div class="detail-content">
        <article>
          <h3>Reasoning</h3>
          <p id="detailReason">—</p>
          <h3>Key Facts</h3>
          <ul id="detailInsights"></ul>
        </article>
        <article>
          <h3>Fraud Type</h3>
          <p id="detailLeadTypes">—</p>
          <h3>Provider / Organization</h3>
          <p id="detailPower">—</p>
          <h3>Federal Programs</h3>
          <p id="detailAgencies">—</p>
          <h3>Violation Categories</h3>
          <p id="detailTags">—</p>
          <h3>Model</h3>
          <p id="detailModel">—</p>
        </article>
        <article class="detail-text">
          <div class="detail-text-header">
            <h3>Original Text</h3>
            <button id="detailTextToggle" type="button" class="text-toggle">Expand</button>
          </div>
          <p id="detailTextPreview" class="text-preview">—</p>
          <pre id="detailText" class="text-full hidden">—</pre>
        </article>
      </div>
    </section>

    <section class="charts">
      <article>
        <h2>Top Providers at Risk</h2>
        <canvas id="powerChart" height="120"></canvas>
      </article>
      <article>
        <h2>Fraud Type Breakdown</h2>
        <canvas id="leadChart" height="120"></canvas>
      </article>
      <article>
        <h2>Federal Programs Affected</h2>
        <canvas id="agencyChart" height="120"></canvas>
      </article>
      <article>
        <h2>Qui Tam Risk Score Distribution</h2>
        <canvas id="scoreChart" height="120"></canvas>
      </article>
    </section>

    <section class="methodology">
      <details class="methodology-collapse">
        <summary>How Qui Tam Scoring Works</summary>
        <p>
          Each provider record is analyzed locally through LM Studio using the open-source OpenAI GPT-OSS-120B model. The AI evaluates Medicare/Medicaid fraud potential for False Claims Act violations. All analysis is done completely offline – no cloud, no API calls, no data leaving the machine.
        </p>
        <details class="accordion" open>
          <summary>Qui Tam Scoring Criteria (click to toggle)</summary>
          <ul>
            <li><strong>Federal Program Involvement:</strong> Does it explicitly mention Medicare, Medicaid, TRICARE, or VA?</li>
            <li><strong>Fraud Type:</strong> Upcoding, phantom billing, kickbacks, unnecessary procedures, off-label marketing?</li>
            <li><strong>Systematic Pattern:</strong> Is it a one-time error or repeated systematic fraud?</li>
            <li><strong>Provable Damages:</strong> Can we calculate actual dollar losses to the government?</li>
            <li><strong>Evidence Strength:</strong> Is there documentation, whistleblowers, or government investigations?</li>
            <li><strong>Statute of Limitations:</strong> Did fraud occur within the last 6 years?</li>
          </ul>
          <p>Scores above ~70 indicate strong qui tam potential - systematic fraud against federal programs with provable damages >$500k.</p>
        </details>
        <details class="accordion">
          <summary>LLM prompt (full text)</summary>
          <pre>
You are a qui tam whistleblower investigator analyzing healthcare provider records to identify potential False Claims Act violations.

EVALUATE EACH RECORD FOR QUI TAM POTENTIAL (Score 0-100):

HIGH VALUE INDICATORS (70-100 points):
- Medicare/Medicaid fraud explicitly mentioned
- Billing for services not rendered
- Upcoding (billing for more expensive services than provided)
- Kickbacks or illegal referrals (Stark Law, Anti-Kickback Statute violations)
- Systematic patterns (not isolated incidents)
- Large dollar amounts (>$1M in potential damages)
- Recent violations (within 6 years - statute of limitations)

Output JSON with:
- headline
- qui_tam_score (0-100)
- fraud_type
- federal_programs_involved
- estimated_damages
- statute_violations
- evidence_strength
- key_facts
- implicated_entities
- qui_tam_viability (High/Medium/Low)
          </pre>
        </details>
      </details>
    </section>

    <section class="credits">
      <h2>Data Sources</h2>
      <p>
        Data aggregated from:
        <strong>CMS LEIE</strong> (excluded providers),
        <strong>DOJ Press Releases</strong> (settled qui tam cases),
        <strong>State Medical Boards</strong> (disciplinary actions),
        <strong>CMS Open Payments</strong> (pharma kickbacks),
        and <strong>Medicare Utilization Data</strong> (billing patterns).
      </p>
      <p>
        <strong>Legal Disclaimer:</strong> This database is for informational purposes only. 
        Inclusion does not prove guilt. Consult a qui tam attorney before filing any lawsuit.
        Qui tam cases must be filed under seal and require legal representation.
      </p>
    </section>

    <footer class="site-footer">
      <a href="https://github.com/yourusername/medical-ranker" target="_blank" rel="noopener noreferrer" class="support-link">View on GitHub</a>
      <a href="https://github.com/yourusername/medical-ranker/issues" target="_blank" rel="noopener noreferrer" class="support-link">Request features / Report issues</a>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.3.1/dist/ag-grid-community.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <script type="module" src="app.js?v=2"></script>
  </body>
</html>